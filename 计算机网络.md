##  http和https篇



### http简介
http是基于tcp/ip的**应用层协议**，它本身不进行数据交换（**真正进行数据交换的是的tcp/ip**），而是规定了客户端和服务端之间的**通信格式**，默认使用80端口。



### http发展史



#### http0.9（新增内容）
http0.9 是91年发布的，它只有get请求
格式为： GET index.html， 表明TCP连接完成后，客户端向服务端请求网页index.html。协议规定服务器只能以html格式返回字符串。通信结束，断开TCP连接。

缺点：

- 传输体积很小，没有规定请求头和请求体，服务端也不返回响应体。只有GET请求





#### http1.0
http1.0 是96年发布的，核心诉求就是：支持了**多类型传输格式**（使得互联网不仅可以传输文字，还能传输图像、视频、二进制文件。），加入了**请求头（描述一些元数据）和响应头**支持多种不同类型的数据，以及**状态码，多字符集支持，多部分发送（multi-part type），权限（authorization），内容编码（content encoding），cache机制和用户代理等**。定义了三种方法，GET，POST，HEAD。
```JS
1.0版的HTTP请求的例子：

第一行是请求命令，后面是多行头信息
GET / HTTP/1.0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)  #用户代理
Accept: '*'   # 可以接受的响应数据的格式

响应格式（Response）
#第一行是"协议版本 + 状态码（status code） + 状态描述"。
HTTP/1.0 200 OK 
# 信息必须是 ASCII 码，后面的数据可以是任何格式。因此，服务器回应的时候，必须告诉客户端，数据是什么格式，这就是Content-Type字段的作用。
Content-Type: text/plain # 响应内容的格式
Content-Length: 137582	
Expires: Thu, 05 Dec 1997 16:00:00 GMT #过期时间
Last-Modified: Wed, 5 August 1996 15:55:28 GMT #上次修改时间
Server: Apache 0.84 # 服务器
							#空一行，表示下面为响应数据
Hello World  #响应内容
```
缺点：

- 每个TCP连接只能发送一个请求。发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接。 （新增TCP的成本较高，客户端和服务端需要经过三次握手）

为了解决这个问题，浏览器在请求时，用来一个非标准（connecttion：keep-alive），告诉服务端不要关闭TCP连接，以便其他请求复用。同时，服务器也返回（connecttion：keep-alive）。但这存在一个问题，不同浏览器和客户端的实现方式可能不同。

#### http1.1

1997年1月，HTTP/1.1 版本发布，HTTP/1.1进一步完善了 HTTP 协议。

1. 持久连接：http1.1相比较于http1.0版本，最大的变化就是引入了**持久连接**，即TCP默认不断开，可以被多个请求复用，不用声明Connection: keep-alive。
客户端和服务器发现对方一段时间没有活动，就可以主动关闭连接。
不过，规范的做法是，客户端在最后一个请求时，发送Connection: close，明确要求服务器关闭TCP连接。目前，对于同一个域名，大多数浏览器允许同时建立6个持久连接。

2. 管道机制（待扩展）：在同一个TCP连接里面，客户端可以同时发送多个请求。允许浏览器同时发出A请求和B请求，但是服务器还是按照顺序，先回应A请求，完成后再回应B请求。


3. Content-Length 字段： 一个TCP连接现在可以传送多个回应，势必就要有一种机制，区分数据包是属于哪一个回应的。这就是Content-length字段的作用，声明本次回应的数据长度。最后使用一个零长度的块作为发送数据完成的标志

4. 分块传输编码：使用Content-Length字段的前提条件是，服务器发送回应之前，必须知道回应的数据长度。    对于一些很耗时的动态操作来说，这意味着，服务器要等到所有操作完成，才能发送数据，显然这样的效率不高。更好的处理方法是，产生一块数据，就发送一块，采用"流模式"（stream）取代"缓存模式"（buffer）。 

  

  http1.1版规定可以不使用Content-Length字段，而使用"分块传输编码"（chunked transfer encoding）。
  只要请求或回应的头信息有Transfer-Encoding字段，就表明回应将由数量未定的数据块组成：
  Transfer-Encoding: chunked
  每个非空的数据块之前，会有一个16进制的数值，表示这个块的长度。最后是一个大小为0的块，就表示本次回应的数据发送完了。
```JS
# 下面是一个分块传输的例子
HTTP/1.1 200 OK
Content-Type: text/plain
Transfer-Encoding: chunked
25
This is the data in the first chunk
1C
and this is the second one
3
con
8
sequence
0
```
5. 新增了许多动词方法：PUT、PATCH、HEAD、 OPTIONS、DELETE。以及客户端请求的头信息新增了Host字段，用来指定服务器的域名，就可以将请求发往同一台服务器上的不同网站，为虚拟主机的兴起打下了基础。

#### http2.0



### http请求方法

- GET： 获取资源
- POST： 提交/上传数据
- PUT： 修改数据
- HEAD：获取资源的元信息 
- DELETE： 删除资源
- OPTION：列出可对资源实施的请求方法，用来跨域请求
- CONNECT：建立连接渠道，用于代理服务器
- TRACE：追踪请求-响应的传输路径

### http优缺点

优点：

- 灵活可扩展，主要体现在两个方面。一个是语义上的自由，只规定了基本格式，比如空格分隔单词，换行分隔字段，其他的各个部分都没有严格的语法限制。另一个是传输形式的多样性，不仅仅可以传输文本，还能传输图片、视频等任意数据，非常方便。
- 可靠传输。HTTP 基于 TCP/IP，因此把这一特性继承了下来。这属于 TCP 的特性，不具体介绍了。
- 请求-应答。也就是一发一收、有来有回，当然这个请求方和应答方不单单指客户端和服务器之间，如果某台服务器作为代理来连接后端的服务端，那么这台服务器也会扮演请求方的角色。
- 无状态。这里的状态是指通信过程的上下文信息，而每次 HTTP 请求都是独立、无关的，默认不需要保留状态信息。

缺点：
- 无状态。在需要长连接的场景中，需要保存大量的上下文信息，以免传输大量重复的信息，那么这时候无状态就是 HTTP 的缺点了。
- 明文传输。协议里的报文（主要指的是头部）不使用二进制数据，而是文本形式。
- 队头阻塞问题。当 HTTP 开启长连接时，共用一个 TCP 连接，同一时刻只能处理一个请求，那么当前请求耗时过长的情况下，其它的请求只能处于阻塞状态。

### GET 和 POST 的区别
GET 和 POST 方法没有实质区别(都是用的TCP)，只是报文格式不同。
- GET 获取资源；POST 提交/上传 数据。
- GET 请求长度在浏览器中有限制(限制来源于浏览器或者 Web 服务器)，而 POST 并没有(可以使用请求体传输数据)。
- GET 请求会被浏览器主动保留下来（历史记录），而 POST 默认不会。

### HTTP 状态码
- 1XX：表示目前是协议处理的中间状态，还需要后续操作。
  	- 101 Switching Protocols：在 HTTP 升级为 WebSocket 的时候，如果服务器同意变更，就会发送状态码为 101。
- 2XX：表示成功状态。
   - 200 OK：请求成功状态码，响应体中含有数据。
   - 204 No Content：含义同 200，但是响应报文不含实体的主体部分。
   - 206 Partial Content：表示部分内容请求成功。使用场景为 HTTP 分块下载和断点续传，当然也会带上相应的响应头字段 Content-Range。
- 3XX：重定向状态，资源位置发生变动，需要重新请求。
  	- 301 Move Permanently：永久重定向。HTTP 升级 HTTPS，之前站点再也不用，那就是 301。
  	- 302 Found：临时重定向。当前站点暂时不可用，那就是 302，后续可能换回来。
  	- 304 Not Modified：当命中协商缓存时会返回这个状态码。
- 4XX：请求报文有误。
	- 400 Bad Request：请求无效。通常为前后端数据格式不一致或者其他原因。
	- 403 Forbidden：服务器已经得到请求，但是拒绝执行，比如没权限、法律禁止等。
	- 404 Not Found：资源未找到，服务器不存在对应的资源。
- 5XX：服务器端发生错误
	- 500 Internal Server Error：服务器报错，有些时候可以在 Response 看到后端 PHP 等技术的报错信息等。
	- 502 Bad Gateway：服务器正常，但是访问出错。
	- 503 Service Unavailable：服务器繁忙或者停机维护，暂时无法处理请求。


### https

HTTP 的特性是明文传输，因此在传输的每一个环节，数据都有可能被第三方窃取或者篡改。

具体来说，HTTP 数据经过 TCP 层，然后经过 WIFI 路由器、运营商和目标服务器，这些环节中都可能被中间人拿到数据并进行篡改，也就是我们常说的中间人攻击。

简单来说 HTTPS 协议是由** HTTP 和 SSL 协议构建**的可进行**加密传输和身份认证的网络协议**，比 HTTP 协议的安全性更高。

最后一个字母 S 指的是 SSL/TLS 协议，它位于 **HTTP 协议与 TCP/IP 协议中间**。
ssl的主要功能：加密解密在网络中传输的数据包，同时保护这些数据不被修改和伪造。
过程： 
1.	
	- 应用层——>ssl解密——>传输层
	- 传输层——>ssl加密认证——>应用层
2. 验证网络对话中双方的身份。